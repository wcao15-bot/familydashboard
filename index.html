<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Dashboard V22 (Correct Order)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Caveat:wght@700&family=Fredoka:wght@600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #fdfbf7; color: #1f2937; overflow: hidden; touch-action: pan-y; }
        .card { background: #ffffff; border-radius: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #f3f4f6; overflow: hidden; }
        .card-header { background: #f9fafb; border-bottom: 1px solid #f3f4f6; padding: 1rem; }
        .calendar-wrapper iframe { width: 100%; height: 100%; border: none; }
        .page-container { transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .font-hand { font-family: 'Caveat', cursive; }
        .font-kids { font-family: 'Fredoka', sans-serif; }
        .progress-fill { transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        /* Animations */
        @keyframes pop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 3s ease-in-out infinite; }

        /* Apple Music */
        .music-container iframe { border-radius: 16px; border: none; }
        
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, Component } = React;

        // ==========================================
        //  CONFIG AREA
        // ==========================================
        
        const DEFAULT_CONFIG = {
            weather: { lat: '37.33', lon: '-121.88' },
            
            traffic: { 
                apiKey: 'AIzaSyBs5EBimvIHRmnsa_wKQjtwjK0qA_7Gd0g',
                routes: [
                    { label: 'Work', origin: '3208 cortona drive, san jose, ca', destination: '1721 technology drive, san jose, ca' },
                    { label: 'Knowles', origin: '3208 cortona drive, san jose, ca', destination: '555 Knowles Dr, Los Gatos, CA' }
                ]
            },
            
            calendar: { 
                embedCode: '<iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=1&ctz=America%2FLos_Angeles&showPrint=0&title=Noakeses%20Calendar&src=d2NhbzE1QGdtYWlsLmNvbQ&src=OTA1YjcxM2RiOTI5MjUxYWJmNjZmZjlkOTQ0ODFjZmNiNzgxY2QzNWFiZTIzNmEzYmNlMDMwOGE3NDMyZGVlN0Bncm91cC5jYWxlbmRhci5nb29nbGUuY29t&src=Yjg0YzhkM2VlNDg2YTMxYmQzNTA3MTIwOWNmMDVkNWFiZWE3NzA0YzU5ZmIwMzlkNTcyYzA4MmI0ZGVkODkxOUBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&src=ZWYxZTE1MzVmOGQzNWQyNmNjNjJlMThhY2E1NDg2ZDg0NGEyYzM3N2VjZjZiNzY3MDdkYjUzMmNkMmVjZjFiYkBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&src=MjkzNDYxMDI4NDkzZjllOTJkMTE5ZjYwODgxZDgyMWZjYzA0NDM4NjYwYWI4ZTFkZjQxYzEwZjk5M2E3YWUzM0Bncm91cC5jYWxlbmRhci5nb29nbGUuY29t&color=%238e24aa&color=%23f6bf26&color=%23b39ddb&color=%23ef6c00&color=%23d50000" style="border:solid 1px #777" width="800" height="600" frameborder="0" scrolling="no"></iframe>' 
            },
            
            photos: [ 
                './images/family01.jpg', 
                'https://images.unsplash.com/photo-1511895426328-dc8714191300?auto=format&fit=crop&w=1600&q=80', 
                'https://images.unsplash.com/photo-1516627145497-ae6968895b74?auto=format&fit=crop&w=1600&q=80' 
            ],
            
            countdown: { title: 'Summer Break', date: '2025-06-15' },
            
            playlists: [
                { name: "Hits", url: "https://music.apple.com/us/playlist/todays-hits/pl.f4d106fed2bd41149aaacabb233eb5eb" },
                { name: "Chill", url: "https://music.apple.com/us/playlist/chill-mix/pl.pm-4r18833u029b3" },
                { name: "Disney", url: "https://music.apple.com/us/playlist/disney-hits/pl.306129990b79427b875505dc2a04944d" }
            ],

            family: [
                { id: 1, name: 'Mom', score: 120, goalName: 'Spa Day', goalTarget: 500, color: 'bg-rose-100 text-rose-800', calendarUrl: '' },
                { id: 2, name: 'Dad', score: 85, goalName: 'New Drill', goalTarget: 500, color: 'bg-blue-100 text-blue-800', calendarUrl: '<iframe src="https://calendar.google.com/calendar/embed?src=293461028493f9e92d119f60881d821fcc04438660ab8e1df41c10f993a7ae33%40group.calendar.google.com&ctz=America%2FLos_Angeles" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>' },
                { id: 3, name: 'Lincoln', score: 240, goalName: 'Roblox Card', goalTarget: 300, color: 'bg-emerald-100 text-emerald-800', calendarUrl: '<iframe src="https://calendar.google.com/calendar/embed?src=ef1e1535f8d35d26cc62e18aca5486d844a2c377ecf6b76707db532cd2ecf1bb%40group.calendar.google.com&ctz=America%2FLos_Angeles" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>' },
                { id: 4, name: 'Kennedy', score: 190, goalName: 'Lego Set', goalTarget: 250, color: 'bg-purple-100 text-purple-800', calendarUrl: '<iframe src="https://calendar.google.com/calendar/embed?src=b84c8d3ee486a31bd35071209cf05d5abea7704c59fb039d572c082b4ded8919%40group.calendar.google.com&ctz=America%2FLos_Angeles" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>' }
            ],
            
            kennedySchedule: [
                { day: 'Sunday', icon: ['Home'] },
                { day: 'Monday', icon: ['Home', 'Iceskating'] },
                { day: 'Tuesday', icon: ['School'] },
                { day: 'Wednesday', icon: ['School'] },
                { day: 'Thursday', icon: ['School'] },
                { day: 'Friday', icon: ['School'] },
                { day: 'Saturday', icon: ['YMCA'] }
            ]
        };

        // --- STANDARD ICONS ---
        const Icons = {
            Sun: ({size = "w-12 h-12"}) => <svg className={`${size} text-amber-400 fill-amber-100`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Cloud: ({size = "w-12 h-12"}) => <svg className={`${size} text-slate-400 fill-slate-100`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19"/><path d="M12 13.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11Z"/></svg>,
            Rain: ({size = "w-12 h-12"}) => <svg className={`${size} text-blue-400 fill-blue-50`} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>,
            Car: () => <svg className="w-5 h-5 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/><path d="M2 12h12"/></svg>,
            Timer: () => <svg className="w-16 h-16 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></svg>,
            Calendar: () => <svg className="w-5 h-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Music: () => <svg className="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>,
            Smile: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>,
            Heart: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            Maximize: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>,
            Settings: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Rainbow: () => <svg className="w-full h-full" viewBox="0 0 100 50" fill="none"><path d="M10 50 A 40 40 0 0 1 90 50" stroke="#ef4444" strokeWidth="6" strokeLinecap="round" /><path d="M20 50 A 30 30 0 0 1 80 50" stroke="#eab308" strokeWidth="6" strokeLinecap="round" /><path d="M30 50 A 20 20 0 0 1 70 50" stroke="#3b82f6" strokeWidth="6" strokeLinecap="round" /></svg>
        };

        // --- NEW FUN FILLED ICONS FOR KENNEDY ---
        const FunIcons = {
            Home: ({className}) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <path d="M3 10L12 3L21 10V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V10Z" fill="#3B82F6"/>
                    <path d="M2 10L12 2L22 10" stroke="#1E3A8A" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    <path d="M9 22V12H15V22" fill="#93C5FD" stroke="#1E3A8A" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
            ),
            School: ({className}) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <rect x="2" y="6" width="20" height="12" rx="2" fill="#FCD34D"/>
                    <path d="M4 18V20" stroke="#78350F" strokeWidth="2" strokeLinecap="round"/>
                    <path d="M20 18V20" stroke="#78350F" strokeWidth="2" strokeLinecap="round"/>
                    <rect x="4" y="8" width="6" height="5" rx="1" fill="#93C5FD" stroke="#78350F" strokeWidth="2"/>
                    <rect x="14" y="8" width="6" height="5" rx="1" fill="#93C5FD" stroke="#78350F" strokeWidth="2"/>
                    <path d="M2 12H22" stroke="#F59E0B" strokeWidth="2"/>
                    <circle cx="6" cy="18" r="2" fill="#1F2937"/>
                    <circle cx="18" cy="18" r="2" fill="#1F2937"/>
                </svg>
            ),
            YMCA: ({className}) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <text x="50%" y="50%" textAnchor="middle" dy=".35em" fontSize="20" fontWeight="bold" fill="#DC2626" stroke="#991B1B" strokeWidth="1">Y</text>
                </svg>
            ),
            Park: ({className}) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <path d="M12 22V12" stroke="#92400E" strokeWidth="4" strokeLinecap="round"/>
                    <path d="M12 18L7 12L12 6L17 12L12 18Z" fill="#4ADE80" stroke="#166534" strokeWidth="2" strokeLinejoin="round"/>
                    <circle cx="12" cy="7" r="5" fill="#22C55E" stroke="#166534" strokeWidth="2"/>
                    <path d="M18 6L21 3" stroke="#FBBF24" strokeWidth="2" strokeLinecap="round"/>
                    <circle cx="20" cy="4" r="1.5" fill="#F59E0B"/>
                </svg>
            ),
            Playdate: ({className}) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <circle cx="8" cy="12" r="6" fill="#F472B6"/>
                    <circle cx="16" cy="12" r="6" fill="#C084FC"/>
                    <path d="M6 11H10" stroke="#831843" strokeWidth="1.5" strokeLinecap="round"/>
                    <path d="M14 11H18" stroke="#581C87" strokeWidth="1.5" strokeLinecap="round"/>
                    <path d="M8 14C8 14 9 15 10 14" stroke="#831843" strokeWidth="1.5" strokeLinecap="round"/>
                    <path d="M16 14C16 14 17 15 18 14" stroke="#581C87" strokeWidth="1.5" strokeLinecap="round"/>
                </svg>
            ),
            Iceskating: ({className}) => (
                <svg className={className} viewBox="0 0 24 24" fill="none">
                    <path d="M4 18H20" stroke="#60A5FA" strokeWidth="2" strokeLinecap="round"/>
                    <path d="M6 18V15L4 13V6C4 4.89543 4.89543 4 6 4H14C15.1046 4 16 4.89543 16 6V11" stroke="#1E40AF" strokeWidth="2" strokeLinecap="round"/>
                    <path d="M16 11L20 15V18" stroke="#1E40AF" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    <path d="M16 11H6" stroke="#1E40AF" strokeWidth="2"/>
                    <path d="M2 21H22" stroke="#93C5FD" strokeWidth="2" strokeLinecap="round"/>
                </svg>
            )
        };

        class ErrorBoundary extends React.Component {
            constructor(props) { super(props); this.state = { hasError: false, error: null }; }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            render() { if (this.state.hasError) return <div className="p-10 bg-red-50 text-red-900 h-screen flex flex-col items-center justify-center text-center"><h1 className="text-4xl font-bold mb-4">Error</h1><pre>{this.state.error.toString()}</pre></div>; return this.props.children; }
        }

        // --- NEW: KENNEDY'S CALENDAR ---
        const KennedyCalendar = ({ schedule }) => {
            const today = new Date().getDay(); // 0 = Sunday
            const currentMonth = new Date().toLocaleString('default', { month: 'long' }).toUpperCase();
            
            const getIcon = (type, size = "w-20 h-20") => {
                const props = { className: `${size} drop-shadow-md transition hover:scale-110` };
                if (FunIcons[type]) return React.createElement(FunIcons[type], props);
                return <FunIcons.Home {...props} />;
            };

            const colors = ['bg-pink-50', 'bg-blue-50', 'bg-green-50', 'bg-yellow-50', 'bg-purple-50', 'bg-orange-50', 'bg-rose-50'];

            return (
                <div className="card h-full flex flex-col p-8 bg-white border border-slate-100 relative overflow-hidden">
                    <div className="text-center mb-8">
                        <div className="font-kids text-5xl text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 font-extrabold tracking-tight">KENNEDY'S WEEK</div>
                        <div className="font-kids text-2xl text-slate-400 font-bold tracking-widest mt-2">{currentMonth}</div>
                    </div>
                    
                    <div className="flex-1 grid grid-cols-7 gap-4">
                        {schedule.map((item, index) => {
                            const isToday = index === today;
                            const icons = Array.isArray(item.icon) ? item.icon : [item.icon];
                            const hasMultiple = icons.length > 1;

                            return (
                                <div key={index} className="flex flex-col items-center justify-center relative">
                                    {/* Rainbow Indicator for Today */}
                                    {isToday && (
                                        <div className="absolute -top-14 w-32 h-16 animate-float z-20">
                                            <Icons.Rainbow />
                                        </div>
                                    )}
                                    
                                    {/* Day Card */}
                                    <div className={`relative z-10 w-full h-full flex flex-col items-center ${hasMultiple ? 'justify-start pt-8' : 'justify-center'} rounded-3xl border-4 transition-all duration-300
                                        ${isToday ? 'bg-yellow-100 border-yellow-300 shadow-xl scale-105' : `${colors[index]} border-transparent opacity-90`}`}>
                                        
                                        <div className={`font-kids text-xl mb-4 uppercase tracking-wider font-bold ${isToday ? 'text-yellow-700' : 'text-slate-400'}`}>
                                            {item.day.substring(0, 3)}
                                        </div>
                                        
                                        <div className={`flex flex-wrap justify-center gap-2 ${hasMultiple ? 'px-2' : ''}`}>
                                            {icons.map((iconName, i) => (
                                                <div key={i} className="flex flex-col items-center">
                                                    {getIcon(iconName, hasMultiple ? "w-12 h-12" : "w-20 h-20")}
                                                    {hasMultiple && (
                                                        <div className={`font-kids text-sm mt-1 font-bold ${isToday ? 'text-yellow-800' : 'text-slate-500'}`}>
                                                            {iconName}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                        
                                        {!hasMultiple && icons.length > 0 && (
                                            <div className={`font-kids text-lg mt-4 font-bold ${isToday ? 'text-yellow-800' : 'text-slate-500'}`}>
                                                {icons[0]}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- WIDGETS ---

        const Clock = () => {
            const [time, setTime] = useState(new Date());
            useEffect(() => { const t = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(t); }, []);
            return (
                <div className="flex flex-col">
                    <h1 className="text-8xl font-bold tracking-tight text-slate-800 leading-none">
                        {time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }).replace(/\s[AP]M/, '')}
                        <span className="text-2xl text-slate-400 font-medium ml-1">{time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }).slice(-2)}</span>
                    </h1>
                    <p className="text-3xl text-slate-500 font-light mt-1">{time.toLocaleDateString([], { weekday: 'long', month: 'long', day: 'numeric' })}</p>
                </div>
            );
        };

        const Weather = ({ lat, lon }) => {
            const [data, setData] = useState(null);
            
            useEffect(() => {
                const f = async () => { 
                    try { 
                        // Fetch Daily Forecast
                        const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&timezone=auto`); 
                        const d = await r.json(); 
                        setData(d); 
                    } catch (e) {} 
                };
                f(); 
                const t = setInterval(f, 600000); 
                return () => clearInterval(t);
            }, [lat, lon]);

            if (!data) return <div className="text-slate-300">Loading...</div>;
            
            const getIcon = (code, size="w-12 h-12") => {
                if (code <= 1) return <Icons.Sun size={size} />;
                if (code <= 3) return <Icons.Cloud size={size} />;
                return <Icons.Rain size={size} />;
            };

            const current = data.current_weather;
            const daily = data.daily;
            // Get Tomorrow (Index 1) and Day After (Index 2)
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate() + 1);
            const dayAfter = new Date(); dayAfter.setDate(dayAfter.getDate() + 2);

            return (
                <div className="flex items-center gap-6 bg-white px-6 py-3 rounded-2xl shadow-sm border border-slate-100">
                    {/* Current */}
                    <div className="flex items-center gap-4">
                        <div className="text-right">
                            <div className="text-4xl font-bold text-slate-800">{Math.round(current.temperature)}°</div>
                            <div className="text-xs text-slate-400 font-bold uppercase tracking-wider">Now</div>
                        </div>
                        {getIcon(current.weathercode)}
                    </div>
                    
                    <div className="w-px h-12 bg-slate-100"></div>

                    {/* Forecast */}
                    <div className="flex gap-4">
                        <div className="text-center">
                            <div className="text-[10px] text-slate-400 font-bold uppercase mb-1">{days[tomorrow.getDay()]}</div>
                            {getIcon(daily.weathercode[1], "w-6 h-6 mx-auto")}
                            <div className="text-sm font-bold text-slate-600 mt-1">{Math.round(daily.temperature_2m_max[1])}°</div>
                        </div>
                        <div className="text-center">
                            <div className="text-[10px] text-slate-400 font-bold uppercase mb-1">{days[dayAfter.getDay()]}</div>
                            {getIcon(daily.weathercode[2], "w-6 h-6 mx-auto")}
                            <div className="text-sm font-bold text-slate-600 mt-1">{Math.round(daily.temperature_2m_max[2])}°</div>
                        </div>
                    </div>
                </div>
            );
        };

        const Traffic = ({ apiKey, routes }) => {
            const [durations, setDurations] = useState({});
            const [error, setError] = useState(null);
            
            useEffect(() => {
                if (!apiKey || !routes) return;
                
                const getRoute = () => { 
                    if (!window.google || !window.google.maps) return;
                    
                    routes.forEach((route, index) => {
                        const directionsService = new window.google.maps.DirectionsService();
                        directionsService.route(
                            { origin: route.origin, destination: route.destination, travelMode: 'DRIVING', drivingOptions: { departureTime: new Date() } }, 
                            (res, stat) => { 
                                if(stat === 'OK') {
                                    // Use duration_in_traffic if available, otherwise standard duration
                                    const time = res.routes[0].legs[0].duration_in_traffic ? res.routes[0].legs[0].duration_in_traffic.text : res.routes[0].legs[0].duration.text;
                                    setDurations(prev => ({...prev, [index]: time}));
                                } else {
                                    console.error(`Traffic Error for ${route.label}:`, stat);
                                    setError(stat);
                                }
                            }
                        );
                    });
                };

                if (!window.google) { 
                    const s = document.createElement("script"); 
                    s.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places`; 
                    s.async = true; 
                    s.onload = getRoute; 
                    document.body.appendChild(s); 
                } else { 
                    getRoute(); 
                }
                
                const t = setInterval(getRoute, 900000); 
                return () => clearInterval(t);
            }, [apiKey, routes]);

            return (
                <div className="card h-full p-6 flex flex-col justify-center bg-white gap-4 relative">
                    {error && <div className="absolute top-2 right-2 text-[10px] text-red-400 font-mono">Err: {error}</div>}
                    <div className="flex items-center gap-2 border-b border-slate-50 pb-2">
                        <div className="bg-emerald-100 p-1.5 rounded-full"><Icons.Car /></div>
                        <span className="text-slate-400 text-xs font-bold uppercase tracking-wider">Commute</span>
                    </div>
                    
                    <div className="space-y-4">
                        {routes.map((route, i) => (
                            <div key={i} className="flex justify-between items-end">
                                <div>
                                    <div className="text-3xl font-bold text-slate-800 leading-none tracking-tight">{durations[i] || '--'}</div>
                                    <div className="text-xs text-slate-500 mt-1 font-bold uppercase">{route.label}</div>
                                </div>
                                <div className="text-[10px] text-slate-300 max-w-[80px] truncate text-right">
                                    {route.destination.split(',')[0]}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Photos = ({ images, embedUrl }) => {
            const [idx, setIdx] = useState(0);
            
            useEffect(() => { 
                if (!embedUrl) {
                    const t = setInterval(() => setIdx(i => (i + 1) % images.length), 10000); 
                    return () => clearInterval(t); 
                }
            }, [images, embedUrl]);

            const handleError = () => {
                console.warn(`Could not load image: ${images[idx]}. Skipping...`);
                setIdx(i => (i + 1) % images.length);
            }

            if (embedUrl) {
                return (
                    <div className="card w-full h-full relative border-0 shadow-lg bg-black">
                        <iframe src={embedUrl} className="w-full h-full border-none" scrolling="no" />
                    </div>
                );
            }

            if (!images?.length) return <div className="card h-full flex items-center justify-center text-slate-400 bg-slate-50">No Photos</div>;
            
            return (
                <div className="card w-full h-full relative border-0 shadow-lg bg-slate-200">
                    <img 
                        src={images[idx]} 
                        className="w-full h-full object-cover absolute inset-0 transition-opacity duration-1000" 
                        onError={handleError}
                        alt="Slideshow"
                    />
                </div>
            );
        };

        const ScribblePad = () => {
            const canvasRef = useRef(null);
            const clearCanvas = () => { const ctx = canvasRef.current.getContext('2d'); ctx.clearRect(0,0,1000,1000); localStorage.setItem('scribblePadV11', ''); };
            useEffect(() => {
                const canvas = canvasRef.current; const ctx = canvas.getContext('2d');
                const resize = () => { const d = canvas.toDataURL(); canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; const i = new Image(); i.src = d; i.onload = () => ctx.drawImage(i,0,0); ctx.strokeStyle = '#334155'; ctx.lineWidth = 3; ctx.lineCap = 'round'; };
                window.addEventListener('resize', resize); setTimeout(resize, 100);
                const s = localStorage.getItem('scribblePadV11'); if(s) { const i = new Image(); i.src = s; i.onload = () => ctx.drawImage(i,0,0); }
                return () => window.removeEventListener('resize', resize);
            }, []);
            const draw = (e) => { if (e.buttons !== 1) return; const ctx = canvasRef.current.getContext('2d'); const rect = canvasRef.current.getBoundingClientRect(); ctx.lineTo((e.clientX || e.touches[0].clientX) - rect.left, (e.clientY || e.touches[0].clientY) - rect.top); ctx.stroke(); };
            const start = (e) => { const ctx = canvasRef.current.getContext('2d'); ctx.beginPath(); const rect = canvasRef.current.getBoundingClientRect(); ctx.moveTo((e.clientX || e.touches[0].clientX) - rect.left, (e.clientY || e.touches[0].clientY) - rect.top); };
            const end = () => localStorage.setItem('scribblePadV11', canvasRef.current.toDataURL());
            return (
                <div className="card h-full relative bg-yellow-50 border-yellow-100 shadow-sm">
                    <div className="absolute top-4 left-4 text-yellow-800/40 font-hand text-2xl pointer-events-none">Quick Note...</div>
                    <button onClick={clearCanvas} className="absolute top-4 right-4 text-xs text-yellow-700 hover:bg-yellow-200/50 px-3 py-1 rounded-full transition">Clear</button>
                    <canvas ref={canvasRef} className="w-full h-full touch-none" onMouseDown={start} onMouseMove={draw} onMouseUp={end} onTouchStart={start} onTouchMove={draw} onTouchEnd={end} />
                </div>
            );
        };

        const TaskList = ({ member, onUpdateScore }) => {
            const tasks = [{ id: 1, t: "Make Bed", p: 5 }, { id: 2, t: "Clear Table", p: 10 }, { id: 3, t: "Homework", p: 15 }, { id: 4, t: "Brush Teeth", p: 5 }];
            const percent = Math.min(100, (member.score / (member.goalTarget || 100)) * 100);
            
            return (
                <div className="card h-full flex flex-col fade-in border-0 shadow-lg">
                    <div className="card-header bg-white pt-6 pb-4">
                        <div className="flex justify-between items-center mb-4">
                            <div className="flex items-center gap-3">
                                <div className={`w-3 h-8 rounded-full ${member.color.split(' ')[0]}`}></div>
                                <div>
                                    <h3 className="font-bold text-2xl text-slate-800">{member.name}'s Tasks</h3>
                                    <div className="text-xs text-slate-400 font-bold uppercase tracking-wider">Goal: {member.goalName}</div>
                                </div>
                            </div>
                            <div className="text-right">
                                <span className="text-3xl font-bold text-slate-800">{member.score}</span>
                                <span className="text-sm text-slate-400 font-medium"> / {member.goalTarget}</span>
                            </div>
                        </div>
                        <div className="h-4 w-full bg-slate-100 rounded-full overflow-hidden">
                            <div className={`h-full progress-fill ${member.color.split(' ')[0]}`} style={{width: `${percent}%`}}></div>
                        </div>
                    </div>
                    
                    <div className="p-6 space-y-3 overflow-y-auto flex-1 bg-slate-50/50">
                        {tasks.map(task => (
                            <div key={task.id} className="flex items-center justify-between bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition cursor-pointer active:scale-[0.99]" onClick={() => onUpdateScore(member.id, task.p)}>
                                <span className="text-lg font-medium text-slate-700">{task.t}</span>
                                <span className={`px-3 py-1 rounded-lg text-sm font-bold ${member.color}`}>+{task.p}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const CalendarView = ({ memberUrl, defaultUrl }) => {
            const url = memberUrl || defaultUrl;
            const src = url.match(/src="([^"]+)"/)?.[1] || "";
            return (
                <div className="card h-full flex flex-col fade-in border-0 shadow-lg">
                    <div className="card-header bg-white py-4"><h3 className="font-bold text-xl text-slate-800 flex items-center gap-2"><Icons.Calendar /> Schedule</h3></div>
                    <div className="flex-1 calendar-wrapper bg-white">{src ? <iframe src={src} scrolling="no" /> : <div className="h-full flex items-center justify-center text-slate-400">No Calendar Linked</div>}</div>
                </div>
            );
        };

        const AppleMusicPlayer = ({ playlists }) => {
            const [activeUrl, setActiveUrl] = useState(playlists[0]?.url || "");
            const getEmbedUrl = (url) => url ? url.replace("music.apple.com", "embed.music.apple.com") : "";

            return (
                <div className="card h-full flex flex-col p-6 bg-white border-2 border-pink-100 shadow-xl">
                    <h3 className="text-pink-400 font-kids text-3xl mb-4 flex items-center gap-3 font-bold">
                        <Icons.Music /> DJ Station
                    </h3>
                    
                    <div className="flex-1 music-container bg-pink-50 rounded-2xl overflow-hidden shadow-inner mb-6 relative">
                        <iframe src={getEmbedUrl(activeUrl)} width="100%" height="100%" allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" loading="lazy" className="absolute inset-0"></iframe>
                    </div>

                    <div className="flex gap-3 overflow-x-auto pb-1 no-scrollbar">
                        {playlists.map((pl, i) => (
                            <button 
                                key={i} 
                                onClick={() => setActiveUrl(pl.url)} 
                                className={`flex-1 min-w-[120px] py-4 px-4 rounded-xl font-kids text-lg font-bold transition transform active:scale-95 whitespace-nowrap shadow-md ${activeUrl === pl.url ? 'bg-pink-500 text-white ring-4 ring-pink-200' : 'bg-slate-50 text-slate-500 hover:bg-slate-100'}`}
                            >
                                {pl.name}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const JokeWidget = () => {
            const [joke, setJoke] = useState(null);
            const [showPunchline, setShowPunchline] = useState(false);
            
            const fetchJoke = async () => {
                setShowPunchline(false);
                try {
                    const res = await fetch('https://official-joke-api.appspot.com/jokes/random');
                    const data = await res.json();
                    setJoke(data);
                } catch (e) { setJoke({ setup: "Why did the chicken cross?", punchline: "To get to the other side!" }); }
            };
            useEffect(() => { fetchJoke(); }, []);

            return (
                <div onClick={() => { if(!showPunchline) setShowPunchline(true); else fetchJoke(); }} className="card p-8 h-full flex flex-col items-center justify-center text-center cursor-pointer relative bg-gradient-to-br from-indigo-50 to-purple-50 hover:shadow-xl transition border-2 border-purple-100 select-none active:scale-[0.98]">
                    <div className="absolute top-6 left-6 text-purple-400 text-sm font-bold uppercase tracking-widest bg-white/50 px-3 py-1 rounded-full flex items-center gap-1"><Icons.Smile /> Joke of the Day</div>
                    {joke ? (
                        <div className="mt-8 flex flex-col items-center justify-center h-full w-full">
                            <div className="font-kids text-4xl text-slate-800 mb-8 leading-snug font-bold max-w-md">{joke.setup}</div>
                            {showPunchline ? (
                                <div className="font-kids text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-indigo-600 animate-pop leading-tight drop-shadow-sm">
                                    {joke.punchline}
                                    <div className="text-sm font-sans font-medium text-slate-400 mt-6 opacity-60">(Tap for another)</div>
                                </div>
                            ) : (
                                <button className="bg-purple-500 text-white px-8 py-3 rounded-full text-xl font-bold shadow-lg shadow-purple-200 hover:bg-purple-600 transition transform hover:-translate-y-1">
                                    Tap for Answer
                                </button>
                            )}
                        </div>
                    ) : <div className="animate-pulse text-2xl font-kids text-slate-300">Finding a good one...</div>}
                </div>
            );
        };

        const Countdown = ({ targetDate, title }) => {
            const [timeLeft, setTimeLeft] = useState("");
            useEffect(() => {
                const calc = () => {
                    const diff = new Date(targetDate) - new Date();
                    setTimeLeft(diff < 0 ? "Hooray!" : `${Math.floor(diff / (1000 * 60 * 60 * 24))} Days`);
                };
                calc();
                const t = setInterval(calc, 3600000); return () => clearInterval(t);
            }, [targetDate]);
            return (
                <div className="card px-8 flex flex-row items-center justify-between h-full bg-blue-50 border-2 border-blue-100 shadow-md">
                    <div className="flex items-center gap-4">
                        <div className="bg-blue-200 p-2 rounded-lg text-blue-700"><Icons.Calendar /></div>
                        <div>
                            <div className="text-blue-400 uppercase tracking-widest text-xs font-bold">Countdown</div>
                            <div className="font-kids text-2xl text-blue-900 font-bold">{title}</div>
                        </div>
                    </div>
                    <div className="font-kids text-5xl font-extrabold text-blue-500">{timeLeft}</div>
                </div>
            );
        };

        const Settings = ({ isOpen, onClose, config, onSave }) => {
            const [temp, setTemp] = useState(config);
            if(!isOpen) return null;
            const handleFamily = (idx, field, val) => { const fam = [...temp.family]; fam[idx][field] = val; setTemp({...temp, family: fam}); };
            const handlePlaylist = (idx, field, val) => { const pl = [...temp.playlists]; pl[idx][field] = val; setTemp({...temp, playlists: pl}); };
            
            // UPDATED: Handle multi-select for icons
            const handleKennedySchedule = (dayIdx, iconName) => {
                const sched = [...temp.kennedySchedule];
                const currentIcons = Array.isArray(sched[dayIdx].icon) ? sched[dayIdx].icon : [sched[dayIdx].icon];
                
                let newIcons;
                if (currentIcons.includes(iconName)) {
                    newIcons = currentIcons.filter(i => i !== iconName);
                } else {
                    newIcons = [...currentIcons, iconName];
                }
                
                sched[dayIdx].icon = newIcons;
                setTemp({...temp, kennedySchedule: sched});
            };
            
            // UPDATED: Added Iceskating
            const iconOptions = ['Home', 'School', 'YMCA', 'Playdate', 'Park', 'Iceskating'];

            return (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center">
                    <div className="bg-white w-[700px] max-h-[85vh] rounded-2xl shadow-2xl flex flex-col">
                        <div className="p-6 border-b border-slate-100 flex justify-between"><h2 className="text-2xl font-bold">Settings</h2><button onClick={onClose}>✕</button></div>
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 text-slate-800">
                            
                            {/* UPDATED: Multi-select UI for Kennedy's Calendar */}
                            <section>
                                <h3 className="text-slate-400 uppercase text-xs font-bold mb-4">Kennedy's Calendar Icons</h3>
                                <div className="space-y-4">
                                    {temp.kennedySchedule.map((day, i) => {
                                        const currentIcons = Array.isArray(day.icon) ? day.icon : [day.icon];
                                        return (
                                            <div key={i} className="bg-slate-50 p-3 rounded-xl border border-slate-200">
                                                <div className="font-bold text-sm mb-2">{day.day}</div>
                                                <div className="flex flex-wrap gap-2">
                                                    {iconOptions.map(opt => {
                                                        const isSelected = currentIcons.includes(opt);
                                                        return (
                                                            <button 
                                                                key={opt} 
                                                                onClick={() => handleKennedySchedule(i, opt)}
                                                                className={`px-3 py-1.5 rounded-full text-xs font-bold transition-all ${isSelected ? 'bg-blue-500 text-white shadow-md' : 'bg-white text-slate-500 border border-slate-200 hover:bg-slate-100'}`}
                                                            >
                                                                {opt}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </section>

                            <section>
                                <h3 className="text-slate-400 uppercase text-xs font-bold mb-4">Family & Rewards</h3>
                                {temp.family.map((mem, i) => (
                                    <div key={i} className="bg-slate-50 p-4 rounded-xl border border-slate-200 mb-4">
                                        <div className="flex gap-4 mb-3">
                                            <input className="bg-white p-2 rounded w-1/3 border border-slate-200 font-bold" value={mem.name} onChange={e => handleFamily(i, 'name', e.target.value)} />
                                            <input className="bg-white p-2 rounded flex-1 border border-slate-200 text-sm" placeholder="Reward Goal Name" value={mem.goalName || ''} onChange={e => handleFamily(i, 'goalName', e.target.value)} />
                                            <input className="bg-white p-2 rounded w-20 border border-slate-200 text-sm" type="number" placeholder="Target" value={mem.goalTarget || ''} onChange={e => handleFamily(i, 'goalTarget', e.target.value)} />
                                        </div>
                                        <input className="w-full bg-white p-2 rounded text-xs font-mono border border-slate-200 text-slate-500" placeholder="Calendar Embed Code" value={mem.calendarUrl || ''} onChange={e => handleFamily(i, 'calendarUrl', e.target.value)} />
                                    </div>
                                ))}
                            </section>

                            <section>
                                <h3 className="text-slate-400 uppercase text-xs font-bold mb-4">Kids Zone</h3>
                                <div className="space-y-3">
                                    {temp.playlists.map((pl, i) => (
                                        <div key={i} className="flex gap-2">
                                            <input className="bg-slate-50 p-2 rounded w-1/3 border border-slate-200" value={pl.name} onChange={e => handlePlaylist(i, 'name', e.target.value)} />
                                            <input className="bg-slate-50 p-2 rounded flex-1 border border-slate-200 text-xs" value={pl.url} onChange={e => handlePlaylist(i, 'url', e.target.value)} />
                                        </div>
                                    ))}
                                    <div className="flex gap-4 mt-4">
                                        <input className="bg-slate-50 p-2 rounded flex-1 border border-slate-200" placeholder="Countdown Title" value={temp.countdown.title} onChange={e => setTemp({...temp, countdown: {...temp.countdown, title: e.target.value}})} />
                                        <input className="bg-slate-50 p-2 rounded w-40 border border-slate-200" type="date" value={temp.countdown.date} onChange={e => setTemp({...temp, countdown: {...temp.countdown, date: e.target.value}})} />
                                    </div>
                                </div>
                            </section>

                            <section>
                                <h3 className="text-slate-400 uppercase text-xs font-bold mb-4">System</h3>
                                <div className="space-y-4">
                                    <input className="w-full bg-slate-50 p-3 rounded border border-slate-200 text-xs" placeholder="Default Calendar Code" value={temp.calendar.embedCode} onChange={e => setTemp({...temp, calendar: {...temp.calendar, embedCode: e.target.value}})} />
                                    <input className="w-full bg-slate-50 p-3 rounded border border-slate-200" placeholder="Traffic API Key" value={temp.traffic.apiKey} onChange={e => setTemp({...temp, traffic: {...temp.traffic, apiKey: e.target.value}})} />
                                    <input className="w-full bg-slate-50 p-3 rounded border border-slate-200" placeholder="Photo Embed URL (Optional)" value={temp.photoEmbedUrl || ''} onChange={e => setTemp({...temp, photoEmbedUrl: e.target.value})} />
                                </div>
                            </section>
                        </div>
                        <div className="p-6 border-t border-slate-100 flex justify-end gap-3"><button onClick={onClose} className="px-6 py-2 text-slate-400">Cancel</button><button onClick={() => onSave(temp)} className="px-6 py-2 bg-slate-800 text-white rounded-lg font-bold">Save</button></div>
                    </div>
                </div>
            )
        }

        const Dashboard = () => {
            const [page, setPage] = useState(0); 
            const [selectedMemberIdx, setSelectedMemberIdx] = useState(null); 
            const [showSettings, setShowSettings] = useState(false);
            const [quickNote, setQuickNote] = useState(() => localStorage.getItem('dashQuickNote') || "Don't forget milk!");
            const touchStart = useRef(null);
            
            const [config, setConfig] = useState(() => {
                // UPDATED: Changed config key to V19
                try { const s = localStorage.getItem('dashConfigV19'); return s ? JSON.parse(s) : DEFAULT_CONFIG; } 
                catch(e) { return DEFAULT_CONFIG; }
            });

            const onTouchEnd = (e) => {
                if (!touchStart.current) return;
                const dist = touchStart.current - e.changedTouches[0].clientX;
                // Allow up to page 4 (5 pages total, index 4)
                if (dist > 50 && page < 4) setPage(page + 1);
                if (dist < -50 && page > 0) setPage(page - 1);
                touchStart.current = null;
            };

            const handleScore = (memId, delta) => {
                const newFam = config.family.map(m => m.id === memId ? { ...m, score: m.score + delta } : m);
                const newConfig = { ...config, family: newFam };
                setConfig(newConfig);
                localStorage.setItem('dashConfigV19', JSON.stringify(newConfig));
            };

            const saveConfig = (newConf) => {
                setConfig(newConf);
                localStorage.setItem('dashConfigV19', JSON.stringify(newConf));
                setShowSettings(false);
            }

            const toggleFullScreen = () => {
                if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); } 
                else { if (document.exitFullscreen) { document.exitFullscreen(); } }
            };

            useEffect(() => { if(window.lucide) window.lucide.createIcons(); });

            return (
                <div className="h-screen w-screen relative select-none" onTouchStart={e => touchStart.current = e.touches[0].clientX} onTouchEnd={onTouchEnd}>
                    <div className="absolute top-0 left-0 w-full p-8 flex justify-between items-start pointer-events-none z-40">
                        <Clock /><Weather lat={config.weather.lat} lon={config.weather.lon} />
                    </div>
                    <button onClick={toggleFullScreen} className="absolute top-6 right-6 p-3 bg-white rounded-full text-slate-400 hover:text-slate-800 z-50 transition shadow-lg"><Icons.Maximize /></button>
                    <button onClick={() => setShowSettings(true)} className="absolute bottom-6 right-6 p-3 bg-white rounded-full text-slate-400 hover:text-slate-800 z-50 transition shadow-lg"><Icons.Settings /></button>

                    {/* Increased width to 500vw for 5 pages */}
                    <div className="flex h-full w-[500vw] page-container" style={{ transform: `translateX(-${page * 20}%)` }}>
                        
                        {/* PAGE 1: GLANCE */}
                        <div className="w-screen h-full p-8 pt-36 grid grid-cols-12 grid-rows-6 gap-6">
                            <div className="col-span-8 row-span-6 rounded-3xl overflow-hidden shadow-xl border-4 border-white"><Photos images={config.photos} embedUrl={config.photoEmbedUrl} /></div>
                            <div className="col-span-4 row-span-2"><Traffic apiKey={config.traffic.apiKey} routes={config.traffic.routes} /></div>
                            <div className="col-span-4 row-span-4"><div className="card h-full p-6 flex flex-col"><div className="text-slate-400 text-xs font-bold uppercase mb-4 tracking-wider">Up Next</div><div className="flex-1 -mx-4 mb-4 relative">{config.calendar.embedCode ? <iframe src={config.calendar.embedCode.match(/src="([^"]+)"/)?.[1] + "&mode=AGENDA&showNav=0&showDate=0&showPrint=0&showTabs=0&showCalendars=0&showTz=0&bgcolor=%23ffffff"} className="w-full h-full border-none" scrolling="no" /> : <div className="p-4 text-slate-400">No Calendar</div>}</div><div className="mt-auto pt-4 border-t border-slate-100"><div className="text-xs text-slate-400 mb-2 font-bold uppercase">Quick Note</div><input className="font-hand text-2xl text-slate-600 bg-transparent w-full border-none focus:outline-none placeholder-slate-300" value={quickNote} onChange={(e) => { setQuickNote(e.target.value); localStorage.setItem('dashQuickNote', e.target.value); }} placeholder="Type note here..." /></div></div></div>
                        </div>

                        {/* PAGE 2: HUB */}
                        <div className="w-screen h-full p-8 pt-36 grid grid-cols-12 grid-rows-12 gap-6">
                            <div className="col-span-12 row-span-1 flex gap-4 overflow-x-auto pb-2 no-scrollbar">
                                <button onClick={() => setSelectedMemberIdx(null)} className={`px-8 py-3 rounded-full font-bold text-lg transition shadow-sm ${selectedMemberIdx === null ? 'bg-slate-800 text-white' : 'bg-white text-slate-500 border border-slate-200'}`}>Family Overview</button>
                                {config.family.map((mem, i) => ( <button key={i} onClick={() => setSelectedMemberIdx(i)} className={`px-6 py-3 rounded-full font-bold text-lg transition shadow-sm flex items-center gap-2 ${selectedMemberIdx === i ? 'bg-slate-800 text-white' : 'bg-white text-slate-500 border border-slate-200'}`}><div className={`w-3 h-3 rounded-full ${mem.color.split(' ')[0]}`}></div>{mem.name}</button> ))}
                            </div>
                            <div className="col-span-7 row-span-11"><CalendarView memberUrl={selectedMemberIdx !== null ? config.family[selectedMemberIdx].calendarUrl : null} defaultUrl={config.calendar.embedCode} /></div>
                            <div className="col-span-5 row-span-11">{selectedMemberIdx !== null ? (<TaskList member={config.family[selectedMemberIdx]} onUpdateScore={handleScore} />) : (<div className="card h-full p-6 flex flex-col border-0 shadow-lg"><div className="card-header bg-white border-none p-0 mb-6"><h3 className="font-bold text-2xl text-slate-800">Weekly Progress</h3></div><div className="space-y-4 overflow-y-auto">{config.family.map((mem, i) => (<div key={i} className={`p-5 rounded-2xl border flex items-center justify-between ${mem.color}`}><div className="flex items-center gap-4"><div className="w-10 h-10 rounded-full bg-white/50 flex items-center justify-center font-bold text-slate-700 shadow-sm">{mem.name[0]}</div><div><div className="font-bold text-lg">{mem.name}</div><div className="text-xs opacity-70 font-bold uppercase">{mem.score} Points</div></div></div></div>))}</div></div>)}</div>
                        </div>

                        {/* PAGE 3: KENNEDY'S CALENDAR */}
                        <div className="w-screen h-full p-8 pt-36 grid grid-cols-12 gap-6">
                             <div className="col-span-12 h-full">
                                 <KennedyCalendar schedule={config.kennedySchedule} />
                             </div>
                        </div>

                        {/* PAGE 4: KIDS ZONE */}
                        <div className="w-screen h-full p-8 pt-36 grid grid-cols-12 grid-rows-12 gap-6">
                            <div className="col-span-12 row-span-1"><h2 className="font-kids text-4xl text-slate-800 font-extrabold flex items-center gap-3"><span className="text-yellow-400">✨</span> Kids Zone</h2></div>
                            <div className="col-span-7 row-span-11 flex flex-col gap-6">
                                <div className="flex-1"><AppleMusicPlayer playlists={config.playlists} /></div>
                            </div>
                            <div className="col-span-5 row-span-11 flex flex-col gap-6">
                                <div className="flex-1"><JokeWidget /></div>
                                <div className="h-32"><Countdown targetDate={config.countdown.date} title={config.countdown.title} /></div>
                            </div>
                        </div>

                        {/* PAGE 5: UTILITY */}
                        <div className="w-screen h-full p-8 pt-36 grid grid-cols-12 gap-6">
                            <div className="col-span-8 h-full"><ScribblePad /></div>
                            <div className="col-span-4 h-full flex flex-col gap-6">
                                <div className="card flex-1 p-6 flex items-center justify-center bg-slate-800 text-white shadow-xl border-slate-700">
                                    <div className="text-center"><Icons.Timer className="mx-auto mb-4" /><div className="text-3xl font-bold">Kitchen Timer</div></div>
                                </div>
                            </div>
                        </div>
                        
                    </div>

                    {/* Page Dots */}
                    <div className="absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-3 z-50 bg-white/80 px-6 py-3 rounded-full backdrop-blur-md border border-slate-200 shadow-lg">
                        {[0, 1, 2, 3, 4].map(i => <button key={i} onClick={() => setPage(i)} className={`w-3 h-3 rounded-full transition-all ${page === i ? 'bg-slate-800 scale-125' : 'bg-slate-300'}`} />)}
                    </div>
                    <Settings isOpen={showSettings} onClose={() => setShowSettings(false)} config={config} onSave={saveConfig} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><Dashboard /></ErrorBoundary>);
    </script>
</body>
</html>